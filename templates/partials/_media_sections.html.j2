{% macro render_media_groups(media_groups, html_settings, gallery_image_max_height, page_size) %}
  {% for group in media_groups %}
    {% for section in group.sections %}
      {% if section.type == MediaType.VIDEO.value %}
        {% for video in section.videos %}
          <div class="section-box">
            <div class="section-title">{{ video.title }}</div>
            <hr>
            <div class="section-content">
              <div class="video-wrapper">
                  <video preload="metadata">
                    <source src="{{ video.full_url }}" type="video/mp4">
                    Your browser does not support the video tag.
                  </video>

                  <div class="video-controls">
                    <button class="control-btn" onclick="toggleVideoPlay(this)">
                      <svg viewBox="0 0 24 24" class="icon play-toggle-icon">
                        <path d="M8 5v14l11-7z" data-play></path>
                        <path d="M6 19h4V5H6v14zm8 0h4V5h-4v14z" data-pause style="display: none;"></path>
                      </svg>
                    </button>

                    <input type="range" class="progress-bar" value="0" step="0.01" onchange="seekVideo(this)" disabled>

                    <span class="time-display">00:00:00 / 00:00:00</span>

                    <div class="volume-container">
                      <svg viewBox="0 0 24 24" class="icon volume-icon">
                        <path d="M5 9v6h4l5 5V4l-5 5H5z" />
                        <path d="M15.5 10.5a1.5 1.5 0 0 1 0 3" fill="none" stroke="currentColor" stroke-width="1.5" />
                        <path d="M17.5 8a4 4 0 0 1 0 8" fill="none" stroke="currentColor" stroke-width="2" />
                      </svg>
                      <input type="range" class="volume-slider" min="0" max="1" step="0.01" oninput="setVideoVolume(this)">
                    </div>

                    <button class="control-btn" onclick="toggleFullscreen(this)">
                      <svg viewBox="0 0 24 24" class="icon fullscreen-icon">
                        <path d="M4 4h6v2H6v4H4V4zm16 0v6h-2V6h-4V4h6zm-6 16v-2h4v-4h2v6h-6zm-6 0H4v-6h2v4h4v2z"/>
                      </svg>
                    </button>
                  </div>
                </div>
            </div>
          </div>
        {% endfor %}
      {% elif section.type == MediaType.AUDIO.value %}
        {% if section.tracks %}
          <div class="section-box">
            <div class="section-title">{{ group.audio_section_title }}</div>
            <hr>
            <div class="section-content">
              <div class="audio-gallery">
                <ul id="track-list-{{ loop.index }}">
                  {% for track in section.tracks %}
                    <li 
                      data-src="{{ track.full_url }}" 
                      onclick="playSelectedTrack(this)"
                      class="track-title">
                      {{ track.title }}
                    </li>
                  {% endfor %}
                </ul>
                <div class="audio-controls">
                  <button class="control-btn" onclick="togglePlay(this)">
                    <svg viewBox="0 0 24 24" class="icon play-toggle-icon">
                      <path d="M8 5v14l11-7z" data-play></path>
                      <path d="M6 19h4V5H6v14zm8 0h4V5h-4v14z" data-pause style="display: none;"></path>
                    </svg>
                  </button>
                  
                  <button class="control-btn" onclick="stopAudio(this)">
                    <svg viewBox="0 0 24 24" class="icon stop-icon"><rect x="6" y="6" width="12" height="12"/></svg>
                  </button>
                  
                  <button class="control-btn" onclick="prevTrack(this)">
                    <svg viewBox="0 0 24 24" class="icon prev-icon">
                      <rect x="5" y="5" width="2" height="14"/>
                      <path d="M18 5v14l-10-7z"/>
                    </svg>
                  </button>

                  <button class="control-btn" onclick="nextTrack(this)">
                    <svg viewBox="0 0 24 24" class="icon next-icon">
                      <path d="M6 5v14l10-7z"/>
                      <rect x="17" y="5" width="2" height="14"/>
                    </svg>
                  </button>

                  <input type="range" class="progress-bar" value="0" step="0.02" onchange="seekAudio(this)">

                  <span class="time-display">00:00:00 / 00:00:00</span>

                  <div class="volume-container">
                    <svg viewBox="0 0 24 24" class="icon volume-icon">
                      <path d="M5 9v6h4l5 5V4l-5 5H5z" />
                      <path d="M15.5 10.5a1.5 1.5 0 0 1 0 3" fill="none" stroke="currentColor" stroke-width="1.5" />
                      <path d="M17.5 8a4 4 0 0 1 0 8" fill="none" stroke="currentColor" stroke-width="2" />
                    </svg>
                    <input type="range" class="volume-slider" min="0" max="1" step="0.01" oninput="setVolume(this)">
                  </div>
                  
                  <audio onended="playNextTrack(this)" preload="metadata" style="display: none;"></audio>
                </div>
              </div>
            </div>
          </div>
        {% endif %}
      {% elif section.type == MediaType.IMAGE.value %}
        {% if section.images %}
          <div class="section-box">
            <div class="section-title">{{ group.image_section_title }}</div>
            <hr>
            <div class="section-content">
              <div class="image-gallery--justified" data-lightbox="true" data-page-size="{{ page_size }}" data-image-max-height="{{ gallery_image_max_height }}">
                {% for image in section.images %}
                  <div class="image-wrapper">
                    <a href="{{ image.full_url }}" target="_blank">
                      <img src="{{ image.thumb_url }}" alt="Image for {{ group.image_label }}">
                      {% if html_settings.project_page_image_gallery_captions_visible %}
                        <span>{{ image.caption }}</span>
                      {% endif %}
                    </a>
                  </div>
                {% endfor %}
              </div>
            </div>
          </div>
        {% endif %}
      {% elif section.type == MediaType.DOCUMENT.value %}
        {% for document in section.documents %}
          <div class="section-box">
            <div class="section-title">{{ document.title }}</div>
            <hr>
            <div class="section-content">
              <iframe src="{{ document.full_url }}" width="100%" height="30rem" style="border: none;"></iframe>
              <a href="{{ document.full_url }}" target="_blank">Full View</a>
            </div>
          </div>
        {% endfor %}
      {% elif section.type == MediaType.TEXT.value %}
        {% for text in section.texts %}
          <div class="section-box markdown">
            <div class="section-title">{{ text.title }}</div>
            <hr>
            <div class="section-content text-content">
              <div class="text-gallery">
                {{ text.content | safe }}
              </div>
            </div>
          </div>
        {% endfor %}
      {% endif %}
    {% endfor %}
  {% endfor %}
{% endmacro %}

